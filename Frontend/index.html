<!DOCTYPE html>
<html>
<head>
  <title>AI Healthcare & Fitness</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
  <div class="container">
    <h2 class="gradient-title"><b>AI Healthcare & Fitness Advisor</b></h2>

    <form id="healthForm">
      <label>Age</label>
      <input type="number" id="age" required>
      
      <label>Gender</label>
      <select id="gender">
        <option value="M">Male</option>
        <option value="F">Female</option>
      </select>
      
      <label>Weight (kg)</label>
      <input type="number" id="weight" required>
      
      <label>Height (cm)</label>
      <input type="number" id="height" required>
      
      <label>Goal</label>
      <select id="goal">
        <option value="Weight Loss">Weight Loss</option>
        <option value="Muscle Gain">Muscle Gain</option>
        <option value="General Fitness">General Fitness</option>
      </select>
      
      <label>Activity Level</label>
      <select id="activity_level">
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
      </select>
      
      <button type="submit">Get Recommendation</button>
      <button type="button" id="downloadBtn" style="display:none;">Download PDF Report</button>
    </form>

    <div id="result"></div>
  </div>

  <script>
    let latestInput = null;

    // Handle form submit
    document.getElementById("healthForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      latestInput = {
        age: document.getElementById("age").value,
        gender: document.getElementById("gender").value,
        weight: document.getElementById("weight").value,
        height: document.getElementById("height").value,
        goal: document.getElementById("goal").value,
        activity_level: document.getElementById("activity_level").value
      };

      let response = await fetch("http://127.0.0.1:5000/api/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(latestInput)
      });

      let result = await response.json();

      document.getElementById("result").innerHTML = `
        <h3>Results</h3>
        <p><b>BMI:</b> ${result.bmi} (${result.risk})</p>
        <p><b>Workout:</b> ${result.workout}</p>
        <p><b>Timeframe:</b> ${result.timeframe}</p>
        <h4>Diet Plan:</h4>
        <ul>
          <li><b>Breakfast:</b> ${result.diet.Breakfast}</li>
          <li><b>Lunch:</b> ${result.diet.Lunch}</li>
          <li><b>Dinner:</b> ${result.diet.Dinner}</li>
          <li><b>Snacks:</b> ${result.diet.Snacks}</li>
        </ul>
      `;

      document.getElementById("downloadBtn").style.display = "inline-block";
    });

    // Handle PDF download
    document.getElementById("downloadBtn").addEventListener("click", async function() {
      if (!latestInput) return;

      let response = await fetch("http://127.0.0.1:5000/api/report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(latestInput)
      });

      if (!response.ok) {
        alert("Failed to generate PDF report.");
        return;
      }

      let blob = await response.blob();
      let url = window.URL.createObjectURL(blob);

      let a = document.createElement("a");
      a.href = url;
      a.download = "health_fitness_report.pdf";
      document.body.appendChild(a);
      a.click();
      a.remove();
    });
  </script>
</body>
</html>
